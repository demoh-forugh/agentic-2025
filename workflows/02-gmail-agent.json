{
  "name": "02 - Email Triage Agent",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 15
            }
          ]
        }
      },
      "id": "schedule-trigger-001",
      "name": "Every 15 Minutes",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [250, 300],
      "notes": "TRIGGER: Automatically runs every 15 minutes to check for new emails"
    },
    {
      "parameters": {
        "operation": "getAll",
        "returnAll": false,
        "limit": 10,
        "filters": {
          "labelIds": ["INBOX", "UNREAD"]
        }
      },
      "id": "gmail-fetch-001",
      "name": "Get Unread Emails",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2,
      "position": [450, 300],
      "notes": "EMAIL FETCH: Retrieves up to 10 unread emails from Gmail inbox",
      "credentials": {
        "googleApi": {
          "id": "1",
          "name": "Google Workshop Account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $json.messages.length }}",
              "operation": "larger",
              "value2": 0
            }
          ]
        }
      },
      "id": "if-has-emails-001",
      "name": "Has Unread Emails?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [650, 300],
      "notes": "CONDITION: Checks if there are any unread emails to process"
    },
    {
      "parameters": {
        "fieldToSplitOut": "messages",
        "options": {}
      },
      "id": "split-items-001",
      "name": "Split Emails",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 1,
      "position": [850, 250],
      "notes": "DATA PROCESSING: Splits email list to process each email individually"
    },
    {
      "parameters": {
        "operation": "get",
        "messageId": "={{ $json.id }}",
        "format": "full"
      },
      "id": "gmail-get-detail-001",
      "name": "Get Email Details",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2,
      "position": [1050, 250],
      "notes": "EMAIL DETAILS: Fetches full email content including headers and body",
      "credentials": {
        "googleApi": {
          "id": "1",
          "name": "Google Workshop Account"
        }
      }
    },
    {
      "parameters": {
        "model": "llama3.2:1b",
        "prompt": "=Analyze this email and provide a JSON response with: category (urgent/important/normal/spam), priority (1-5), summary (1 sentence), and suggested_action (reply/archive/flag/delete).\n\nFrom: {{ $json.payload.headers.find(h => h.name === 'From').value }}\nSubject: {{ $json.payload.headers.find(h => h.name === 'Subject').value }}\nBody: {{ $json.snippet }}",
        "options": {
          "temperature": 0.3,
          "responseFormat": "json"
        }
      },
      "id": "ollama-analyze-001",
      "name": "Analyze with AI",
      "type": "@n8n/n8n-nodes-langchain.lmChatOllama",
      "typeVersion": 1,
      "position": [1250, 250],
      "notes": "AI ANALYSIS: Uses Ollama to categorize email and suggest actions",
      "credentials": {
        "ollamaApi": {
          "id": "1",
          "name": "Ollama Local"
        }
      }
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "email_id",
              "value": "={{ $('Get Email Details').item.json.id }}"
            },
            {
              "name": "from",
              "value": "={{ $('Get Email Details').item.json.payload.headers.find(h => h.name === 'From').value }}"
            },
            {
              "name": "subject",
              "value": "={{ $('Get Email Details').item.json.payload.headers.find(h => h.name === 'Subject').value }}"
            },
            {
              "name": "ai_category",
              "value": "={{ $json.category || 'unknown' }}"
            },
            {
              "name": "ai_priority",
              "value": "={{ $json.priority || 3 }}"
            },
            {
              "name": "ai_summary",
              "value": "={{ $json.summary || 'No summary available' }}"
            },
            {
              "name": "suggested_action",
              "value": "={{ $json.suggested_action || 'review' }}"
            }
          ]
        },
        "options": {}
      },
      "id": "format-results-001",
      "name": "Format Results",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [1450, 250],
      "notes": "DATA FORMATTING: Structures AI analysis results with email metadata"
    },
    {
      "parameters": {
        "resource": "messageLabel",
        "operation": "add",
        "messageId": "={{ $json.email_id }}",
        "labelIds": {
          "labels": ["STARRED"]
        }
      },
      "id": "gmail-label-urgent-001",
      "name": "Star Urgent Emails",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2,
      "position": [1650, 200],
      "notes": "EMAIL ACTION: Stars urgent emails for easy identification",
      "credentials": {
        "googleApi": {
          "id": "1",
          "name": "Google Workshop Account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.ai_category }}",
              "operation": "equals",
              "value2": "urgent"
            }
          ]
        }
      },
      "id": "if-urgent-001",
      "name": "Is Urgent?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [1650, 250],
      "notes": "CONDITION: Routes urgent emails for special handling"
    },
    {
      "parameters": {
        "operation": "append",
        "sheetName": "Email Log",
        "columns": {
          "mappings": [
            {
              "column": "Timestamp",
              "value": "={{ $now.toISO() }}"
            },
            {
              "column": "From",
              "value": "={{ $json.from }}"
            },
            {
              "column": "Subject",
              "value": "={{ $json.subject }}"
            },
            {
              "column": "Category",
              "value": "={{ $json.ai_category }}"
            },
            {
              "column": "Priority",
              "value": "={{ $json.ai_priority }}"
            },
            {
              "column": "Summary",
              "value": "={{ $json.ai_summary }}"
            },
            {
              "column": "Action",
              "value": "={{ $json.suggested_action }}"
            }
          ]
        },
        "options": {}
      },
      "id": "sheets-log-001",
      "name": "Log to Spreadsheet",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 3,
      "position": [1850, 250],
      "notes": "LOGGING: Records all processed emails with AI analysis to Google Sheets",
      "credentials": {
        "googleApi": {
          "id": "1",
          "name": "Google Workshop Account"
        }
      }
    }
  ],
  "connections": {
    "Every 15 Minutes": {
      "main": [
        [
          {
            "node": "Get Unread Emails",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Unread Emails": {
      "main": [
        [
          {
            "node": "Has Unread Emails?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has Unread Emails?": {
      "main": [
        [
          {
            "node": "Split Emails",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Emails": {
      "main": [
        [
          {
            "node": "Get Email Details",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Email Details": {
      "main": [
        [
          {
            "node": "Analyze with AI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze with AI": {
      "main": [
        [
          {
            "node": "Format Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Results": {
      "main": [
        [
          {
            "node": "Is Urgent?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is Urgent?": {
      "main": [
        [
          {
            "node": "Star Urgent Emails",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Log to Spreadsheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Star Urgent Emails": {
      "main": [
        [
          {
            "node": "Log to Spreadsheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "1",
  "id": "2",
  "meta": {
    "instanceId": "workshop-demo",
    "templateCredsSetupCompleted": true
  },
  "tags": [
    {
      "name": "workshop",
      "id": "1"
    },
    {
      "name": "gmail",
      "id": "3"
    },
    {
      "name": "agent",
      "id": "4"
    }
  ],
  "pinData": {}
}
