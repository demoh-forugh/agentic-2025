# Security Guidelines

**Last Updated:** 2025-10-05
**Version:** 1.1.1

---

## Overview

This document outlines security best practices for the workshop repository, focusing on protecting sensitive data, credentials, and preventing accidental exposure.

---

## üîí What's Protected by .gitignore

### Critical (Never Commit)

#### 1. Environment Variables & Secrets
```
.env                    # Local environment variables
.env.local              # Local overrides
.env.production         # Production secrets
*.key                   # Private keys
*.pem                   # SSL/TLS certificates
credentials.json        # API credentials
token.json              # OAuth tokens
*password*              # Any file with "password" in name
*apikey*                # Any file with "apikey" in name
```

#### 2. Google OAuth & API Credentials
```
client_secret*.json     # OAuth client secrets
service-account*.json   # GCP service account keys
oauth-credentials.json  # OAuth credential files
```

#### 3. SSH Keys
```
id_rsa                  # RSA private key
id_dsa                  # DSA private key
id_ecdsa                # ECDSA private key
id_ed25519              # Ed25519 private key
*.pub                   # Public keys (usually safe, but excluded)
```

#### 4. Database Credentials
```
*.db                    # SQLite databases (may contain data)
*.sql.gz                # Compressed database dumps
*.dump                  # PostgreSQL dumps
*-backup.sql            # Database backups
```

#### 5. n8n Encryption Keys
```
encryptionKey.txt       # n8n encryption key
n8n-encryption-key      # Alternative key file
.n8n/                   # n8n local data directory
```

---

## üìÅ What's Excluded for Size/Performance

### Large Files
```
ollama-data/            # Ollama model storage
*.gguf                  # Model files (1-20GB each)
*.ggml                  # Legacy model format
volumes/                # Docker volume data
artifacts/              # Generated performance data
logs/                   # Log files
*.log                   # Individual logs
```

### Generated Files
```
docker-compose.yml      # Copied from configs/ (regenerated by setup)
node_modules/           # NPM dependencies
dist/                   # Build output
build/                  # Compiled artifacts
*.cache                 # Cache files
```

---

## ‚úÖ What IS Committed

### Configuration Templates
```
configs/docker-compose.yml          # Base compose file
configs/docker-compose.gpu.yml      # GPU override
configs/docker-compose.ollama-host.yml # Host Ollama config
configs/.env.example                # Environment variable template
```

### Scripts & Documentation
```
scripts/*.ps1           # PowerShell scripts
scripts/*.sh            # Bash scripts
docs/*.md               # Documentation
workflows/*.json        # n8n workflow examples
examples/*.sql          # Sample database schemas
```

### Repository Metadata
```
.gitignore              # Git exclusion rules
.gitattributes          # Git file handling rules
README.md               # Main documentation
CLAUDE.md               # Claude Code guidance
SECURITY.md             # This file
```

---

## üõ°Ô∏è Security Best Practices

### 1. Never Commit Secrets

**Before committing, check for:**
```bash
# Search for potential secrets
git grep -i password
git grep -i api.?key
git grep -i secret
git grep -i token
```

**Use git-secrets (optional):**
```bash
# Install git-secrets
brew install git-secrets  # macOS
choco install git-secrets # Windows

# Setup
git secrets --install
git secrets --register-aws
```

### 2. Use Environment Variables

**Good:**
```bash
# .env (ignored by git)
GOOGLE_CLIENT_ID=your-client-id
GOOGLE_CLIENT_SECRET=your-secret
POSTGRES_PASSWORD=secure-password
```

**Bad:**
```yaml
# docker-compose.yml (committed)
environment:
  POSTGRES_PASSWORD: "hardcoded-password-123"  # ‚ùå NEVER DO THIS
```

**Correct:**
```yaml
# docker-compose.yml (committed)
environment:
  POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}  # ‚úÖ Reference from .env
```

### 3. Use .env.example Template

**Workflow:**
1. Create `.env.example` with placeholder values
2. Commit `.env.example` to repository
3. Users copy `.env.example` to `.env` and fill in real values
4. `.env` is ignored by git, never committed

**Example .env.example:**
```bash
# Google OAuth Configuration
GOOGLE_CLIENT_ID=your-client-id-here
GOOGLE_CLIENT_SECRET=your-client-secret-here

# PostgreSQL
POSTGRES_USER=workshop
POSTGRES_PASSWORD=change-this-password
POSTGRES_DB=workshop_db

# n8n Encryption Key (generate with: openssl rand -hex 32)
N8N_ENCRYPTION_KEY=your-32-byte-hex-key-here
```

### 4. Rotate Credentials After Exposure

**If you accidentally commit a secret:**

1. **Immediately revoke the credential**
   - Google Cloud Console ‚Üí Credentials ‚Üí Delete
   - Database ‚Üí Change password
   - API provider ‚Üí Rotate key

2. **Remove from Git history**
   ```bash
   # Use BFG Repo-Cleaner (easiest)
   brew install bfg  # macOS
   bfg --replace-text passwords.txt repo.git

   # Or use git filter-branch
   git filter-branch --tree-filter 'rm -f .env' HEAD
   ```

3. **Force push (if repository is private and you're certain)**
   ```bash
   git push --force
   ```

4. **If public repository:**
   - Consider all exposed credentials compromised
   - Rotate immediately
   - May need to reset repository

### 5. Use Secrets Management for Production

**For production deployments:**
- **Docker Secrets** (Swarm mode)
- **Kubernetes Secrets** (K8s deployments)
- **HashiCorp Vault** (Enterprise)
- **AWS Secrets Manager** (AWS)
- **Azure Key Vault** (Azure)
- **Google Secret Manager** (GCP)

---

## üîç Pre-Commit Checklist

Before committing code, verify:

- [ ] No `.env` files staged
- [ ] No files with `password`, `secret`, `key`, `token` in content
- [ ] No API keys or credentials in code
- [ ] No database dumps or backups
- [ ] No large model files (*.gguf, *.ggml)
- [ ] No personal notes with sensitive info
- [ ] Review diff: `git diff --staged`

**Automated check:**
```bash
# Check staged files
git diff --staged --name-only | grep -E '\.(env|key|pem|crt|p12|pfx)$'

# If output is empty, you're good
# If files appear, unstage them: git reset HEAD <file>
```

---

## üìù Workshop-Specific Notes

### What Attendees Should NOT Share

1. **Personal .env files** - Contains OAuth credentials
2. **n8n workflows with credentials** - May contain API keys
3. **Database dumps** - May contain sample data with PII
4. **Custom configurations** - May reveal infrastructure

### What Attendees CAN Share

1. **Workflow JSON files** (without credentials)
2. **SQL schema files** (without data)
3. **Script modifications** (without secrets)
4. **Documentation improvements**

### Sharing Workflows Safely

**Before exporting n8n workflow:**
1. Go to workflow settings
2. Enable "Export without credentials"
3. Review JSON for any hardcoded secrets
4. Share the sanitized workflow

---

## üö® Incident Response

**If you discover a committed secret:**

1. **Report immediately:**
   - Email: dehmohforugh@gmail.com
   - Subject: "SECURITY: Exposed Credential in Workshop Repo"

2. **Include:**
   - Which file/commit
   - What type of secret (API key, password, etc.)
   - When you noticed it
   - Whether it's been pulled by others

3. **We will:**
   - Rotate the credential immediately
   - Remove from Git history if possible
   - Notify affected parties
   - Update security guidelines

---

## üìö Additional Resources

- [GitHub: Removing sensitive data](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/removing-sensitive-data-from-a-repository)
- [OWASP: Secrets Management Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_CheatSheet.html)
- [Git-secrets tool](https://github.com/awslabs/git-secrets)
- [BFG Repo-Cleaner](https://rtyley.github.io/bfg-repo-cleaner/)

---

## ‚úÖ Security Checklist for Workshop Leaders

**Before workshop:**
- [ ] Verify `.env.example` has no real credentials
- [ ] Check all committed files for secrets: `git log -p | grep -i password`
- [ ] Ensure `.gitignore` is comprehensive
- [ ] Test that `.env` is properly ignored
- [ ] Prepare clean credentials for demos

**During workshop:**
- [ ] Remind attendees to use `.env.example` template
- [ ] Show how to verify secrets aren't staged: `git status`
- [ ] Demonstrate safe workflow export in n8n
- [ ] Monitor for accidental secret sharing in chat

**After workshop:**
- [ ] Rotate all demo credentials
- [ ] Review any community contributions for secrets
- [ ] Update security guidelines based on learnings

---

**Remember:** When in doubt, don't commit it. Secrets in Git history are nearly impossible to fully remove once pushed to a public repository.

**Note:** This is provided as-is. No warranty is expressed or implied. But I hope it works for you! If you have any questions or need help, feel free to reach out.
